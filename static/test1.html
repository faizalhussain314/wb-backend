<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Child Frame</title>
  </head>
  <body>
    <div class="div">
      <div class="div-2">
        <div class="div-3">
          <div class="div-4" id="bussinessname">
            ~write a business name here~
          </div>
          <div class="div-5">
            <div class="div-6">Home</div>
            <div class="div-7">Services</div>
            <div class="div-8">About</div>
            <div class="div-9">Contact</div>
          </div>
          <div class="div-10">Get Started</div>
          <button onclick="{fetchContentFromAPI()}">
            click me to regenarate
          </button>
        </div>
        <div class="div-11">
          <div class="div-12">
            <div class="column">
              <section class="div-13 section" data-section="1">
                <div class="div-14" id="shortIntro">
                  ~write a Sub heading text in 3 words for my business~
                </div>
                <span class="hero-heading div-15" id="heroHeading"
                  >~Write a banner heading in 6 words for my business~</span
                >
                <div class="div-16 description" id="shortDescription">
                  ~write a short description for my business~
                </div>
                <div class="div-17">Get Started</div>
              </section>
            </div>
            <div class="column-2">
              <img loading="lazy" srcset="..." class="img" />
            </div>
          </div>
        </div>
      </div>
    </div>
    <section class="why-choose-us section" data-section="2">
      <div class="value-proposition">
        <h3 class="section-subtitle heading" id="whyChooseUsTitle">
          ~write title for Why Choose Us heading text~
        </h3>
        <h2 class="section-title description" id="whyChooseUsDescription">
          ~write title for Why Choose Us main heading text for 6 words~
        </h2>
        <div class="features-container">
          <div class="features-row">
            <div class="feature-column">
              <div class="feature-card">
                <h4 class="feature-title" id="whyChooseUsReason1">
                  ~write first reason for choosing us~
                </h4>
                <p class="feature-description">
                  ~write first reason description for choosing us~
                </p>
              </div>
            </div>
            <div class="feature-column">
              <div class="feature-card">
                <h4 class="feature-title" id="whyChooseUsReason2">
                  ~write second reason for choosing us~
                </h4>
                <p class="feature-description">
                  ~write second reason description for choosing us~
                </p>
              </div>
            </div>
            <div class="feature-column">
              <div class="feature-card">
                <h4 class="feature-title" id="whyChooseUsReason3">
                  ~write third reason for choosing us~
                </h4>
                <p class="feature-description">
                  ~write third reason description for choosing us~
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <div class="quick-services-section">
      <div class="quick-services-container">
        <div class="quick-services-subtitle" id="shortServiceShortIntro">
          ~write a short service introduction~
        </div>
        <div class="quick-services-title" id="serviceIntro">
          ~write a service introduction~
        </div>
        <div class="quick-services-description">
          ~write a service description~
        </div>
        <div class="quick-services-contact">
          <img src="..." alt="Phone icon" class="quick-services-icon" />
          <div class="quick-services-phone">202-555-0188</div>
        </div>
      </div>
    </div>
    <div class="services-container">
      <div class="services-content">
        <section class="services-section">
          <div class="services-info">
            <p class="services-subtitle">Our Services</p>
            <h2 class="services-title" id="services">
              ~write a title for services~
            </h2>
            <p class="services-description" id="serviceDescription">
              ~write a description for services~
            </p>
            <a href="#" class="services-cta">All services</a>
          </div>
          <div class="services-list">
            <div class="service-item">
              <h3 class="service-name">Service 1</h3>
              <p class="service-details">~details for service 1~</p>
            </div>
            <div class="service-item">
              <h3 class="service-name">Service 2</h3>
              <p class="service-details">~details for service 2~</p>
            </div>
            <div class="service-item">
              <h3 class="service-name">Service 3</h3>
              <p class="service-details">~details for service 3~</p>
            </div>
          </div>
        </section>
      </div>
    </div>
    <section class="testimonials-section">
      <div class="testimonials-container">
        <header class="testimonials-header">
          <h2 class="testimonials-title">What Our Clients Say</h2>
          <div class="testimonials-images">
            <img src="..." alt="" class="testimonials-image-1" />
            <img src="..." alt="" class="testimonials-image-2" />
          </div>
        </header>
        <div class="testimonials-content">
          <div class="testimonials-row">
            <div class="testimonial-column">
              <div class="testimonial-card">
                <img src="..." alt="" class="testimonial-icon" />
                <p class="testimonial-text">~write a testimonial 1~</p>
                <div class="testimonial-author">
                  <img src="..." alt="" class="testimonial-author-image" />
                  <span class="testimonial-author-name">Your Client</span>
                </div>
              </div>
            </div>
            <div class="testimonial-column">
              <div class="testimonial-card">
                <img src="..." alt="" class="testimonial-icon" />
                <p class="testimonial-text">~write a testimonial 2~</p>
                <div class="testimonial-author">
                  <img src="..." alt="" class="testimonial-author-image" />
                  <span class="testimonial-author-name">Your Client</span>
                </div>
              </div>
            </div>
            <div class="testimonial-column">
              <div class="testimonial-card">
                <img src="..." alt="" class="testimonial-icon" />
                <p class="testimonial-text">~write a testimonial 3~</p>
                <div class="testimonial-author">
                  <img src="..." alt="" class="testimonial-author-image" />
                  <span class="testimonial-author-name">Your Client</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section class="about-us-section">
      <div class="about-us-container">
        <div class="about-us-content">
          <div class="about-us-text">
            <div class="about-us-details">
              <p class="about-us-subtitle">About Us</p>
              <h2 class="about-us-title" id="aboutUsHeading">
                ~write a title for about us~
              </h2>
              <p class="about-us-description" id="aboutUsDescription">
                ~write a description for about us~
              </p>
              <button class="div-10">Read More</button>
            </div>
          </div>
          <div class="about-us-image">
            <img src="..." alt="About Us" class="about-us-img" />
          </div>
        </div>
      </div>
    </section>
    <section class="connect-section">
      <div class="connect-container">
        <div class="connect-content">
          <h2 class="connect-title" id="contactUsHeading">
            ~write a title for contact us~
          </h2>
          <p class="connect-description" id="callUsTextDescription">
            ~write a description for contact us~
          </p>
          <button class="connect-button">Get Started</button>
          <p class="connect-phone-label">or call us at:</p>
          <p class="connect-phone">202-555-0188</p>
        </div>
      </div>
    </section>
    <footer class="footer-wrapper">
      <div class="footer-content-wrapper">
        <div class="about-us-column-wrapper">
          <div class="about-us-content-wrapper">
            <h2 class="about-us-title-text">About Us</h2>
            <p class="about-us-description-text">
              We are a team of passionate individuals dedicated to delivering
              high-quality products and exceptional customer service. With years
              of experience in the industry, we strive to exceed expectations
              and provide innovative solutions to meet our clients' needs.
            </p>
          </div>
        </div>
        <div class="contact-info-column-wrapper">
          <div class="contact-info-content-wrapper">
            <h3 class="contact-info-title-text">Contact Info</h3>
            <div class="contact-info-item-wrapper">
              <img
                src="https://cdn-icons-png.flaticon.com/512/2838/2838912.png"
                alt="Address Icon"
                class="contact-info-icon-image"
              />
              <p class="contact-info-text-content">
                A: 2360 Hood Avenue, San Diego, CA, 92123
              </p>
            </div>
            <div class="contact-info-item-wrapper">
              <img
                src="https://cdn-icons-png.flaticon.com/512/3059/3059446.png"
                alt="Phone Icon"
                class="contact-info-icon-image"
              />
              <p class="contact-info-text-content">P: 202-555-0188</p>
            </div>
            <div class="contact-info-item-wrapper">
              <img
                src="https://cdn-icons-png.flaticon.com/512/3296/3296467.png"
                alt="Email Icon"
                class="contact-info-icon-image"
              />
              <p class="contact-info-text-content">E: contact@example.com</p>
            </div>
          </div>
        </div>
        <div class="follow-us-column-wrapper">
          <div class="follow-us-content-wrapper">
            <h3 class="follow-us-title-text">Follow Us</h3>
            <div class="social-icons-wrapper">
              <ul class="social-icons-list-wrapper">
                <li>
                  <a
                    href="https://www.facebook.com/example"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="social-icon-link-wrapper facebook-icon-wrapper"
                  >
                    <img
                      src="https://cdn-icons-png.flaticon.com/512/1384/1384053.png"
                      alt="Facebook"
                      class="social-icon-image-element"
                    />
                  </a>
                </li>
                <li>
                  <a
                    href="https://www.twitter.com/example"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="social-icon-link-wrapper twitter-icon-wrapper"
                  >
                    <img
                      src="https://cdn-icons-png.flaticon.com/512/733/733579.png"
                      alt="Twitter"
                      class="social-icon-image-element"
                    />
                  </a>
                </li>
                <li>
                  <a
                    href="https://www.youtube.com/example"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="social-icon-link-wrapper youtube-icon-wrapper"
                  >
                    <img
                      src="https://cdn-icons-png.flaticon.com/512/1384/1384060.png"
                      alt="YouTube"
                      class="social-icon-image-element"
                    />
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <script>
      function collectPrompts() {
        const prompts = {};
        document.querySelectorAll("[id]").forEach((element) => {
          prompts[element.id] = element.textContent;
        });
        return prompts;
      }

      function sendPromptsToParent() {
        const prompts = collectPrompts();
        window.parent.postMessage({ type: "prompts", prompts }, "*"); // Replace '*' with specific origin for security
      }

      document.addEventListener("DOMContentLoaded", sendPromptsToParent);

      function typeEffect(element, text, speed) {
        let index = 0;
        element.textContent = "";
        const interval = setInterval(() => {
          if (index < text.length) {
            element.textContent += text.charAt(index);
            index++;
          } else {
            clearInterval(interval);
          }
        }, speed);
      }

      async function fetchContentFromAPI(businessName, description) {
        try {
          const prompts = collectPrompts();
          console.log(prompts);
          const gptPrompt = `Write website content for this business name "${businessName}", for this description "${description}". If values are null or undefined, create them on your own. Prompts: ${JSON.stringify(
            prompts
          )} don't change the response structure of the prompt send the response same as the prompt json structure`;

          const response = await fetch(
            "http://localhost:8080/StreamIframeController",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ prompt: gptPrompt }),
            }
          );

          const reader = response.body.getReader();
          const decoder = new TextDecoder("utf-8");
          let result = "";
          let content = {};

          while (true) {
            const { value, done } = await reader.read();
            if (done) break;
            result += decoder.decode(value, { stream: true });

            // Parse the result incrementally
            try {
              content = JSON.parse(result);
              console.log(content);
              // Update the content with a typing effect
              for (const key in content) {
                const element = document.getElementById(key);
                if (element) {
                  typeEffect(element, content[key], 0);
                }
              }
            } catch (e) {
              // If JSON parsing fails, continue accumulating more data
            }
          }
        } catch (error) {
          console.error("Error fetching content from API:", error);
        }
      }

      window.addEventListener("message", function (event) {
        if (event.data.type === "start") {
          fetchContentFromAPI(event.data.businessName, event.data.description);
        }
      });
    </script>
  </body>
</html>
